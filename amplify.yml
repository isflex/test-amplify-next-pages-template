version: 1
applications:
  -
    backend:
      phases:
        preBuild:
          commands: 
            - 'nvm install 20.15.0'
            - 'nvm use 20.15.0'
            - 'corepack enable'
            - 'yarn init -2'
        build:
          commands: 
            - 'yarn install --inline-builds --immutable'
            - 'yarn rebuild'
            - 'yarn amplify pipeline-deploy --branch $AWS_BRANCH --app-id $AWS_APP_ID'
    frontend:
      phases:
        preBuild:
          commands: 
            - 'yarn install --inline-builds --immutable'
            - 'yarn rebuild'
        build:
          commands: 
            - 'yarn turbo run build --filter=gateway'
      artifacts:
        baseDirectory: .next
        files:
          - '**/*'
      cache:
        paths:
          - '.next/cache/**/*'
      buildPath: apps/gateway
    appRoot: apps/gateway